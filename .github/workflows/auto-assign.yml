name: Auto-assign Issue

on:
  issues:
    types: [opened]

jobs:
  assign-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js (opcional si quieres lógica más avanzada)
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Assign issue automatically
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TEAM_MEMBERS: "AtomicBanana23,marigj12,gaelcadena5,Scarkat,Joaquower"
        run: |
          ISSUE_NUMBER=${{ github.event.issue.number }}
          
          # Convertir la lista de miembros en un array
          IFS=',' read -ra MEMBERS <<< "$TEAM_MEMBERS"
          
          # Obtener un índice aleatorio o usar el número del issue para determinismo
          INDEX=$((ISSUE_NUMBER % ${#MEMBERS[@]}))
          MEMBER=${MEMBERS[$INDEX]}
          
          echo "Assigning issue #$ISSUE_NUMBER to $MEMBER"
          
          # Asignar el issue (CORREGIDO: usar --add-assignee en lugar de --assignee)
          gh issue edit $ISSUE_NUMBER --add-assignee $MEMBER
          
          echo "Issue #$ISSUE_NUMBER successfully assigned to $MEMBER"

      - name: Complete job
        run: echo "Auto-assignment workflow completed"
